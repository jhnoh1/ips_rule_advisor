<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Page</title>
    <link rel="stylesheet" href="../../static/styles/styles.css">
</head>
<body>

    <!-- 네비게이션 -->
    <nav class="navbar">
        <div class="nav-left">
            <img src="/static/images/logo.png" alt="Logo" class="logo">
        </div>
        <ul class="nav-center">
            <li><a href="/info">정보수집</a></li>
            <li><a href="/rule-test">룰 테스트</a></li>
            <li><a href="/mypage">마이페이지</a></li>
        </ul>
        <div class="nav-right">
            <img src="/static/images/user-avatar.png" alt="User Avatar" class="user-avatar">
            <span>YSD님</span>
        </div>
    </nav>

    <div class="main-container">
        <aside class="sidebar">
            <ul>
                <li><a href="/mypage/info-collection">내 정보수집 기록</a></li>
                <li class="active"><a href="/mypage/rule-test-record">내 룰 테스트 기록</a></li>
                <li><a href="/mypage/final-report-record">내 최종보고서 기록</a></li>
                <li><a href="/mypage/account-management">계정 관리</a></li>
                <li><a href="/mypage/payment-management">결제 관리</a></li>
                <li><a href="/mypage/settings">설정</a></li>
                <li><a href="/logout">로그아웃</a></li>
            </ul>
        </aside>

        <div class="content">
            <h2>내 최종보고서 기록</h2>
            <table class="test-records">
                <thead>
                    <tr>
                        <th>순번</th>
                        <th>CVE 코드</th>
                        <th>시간</th>
                    </tr>
                </thead>
                <tbody id="record-table-body">
                    <!-- JavaScript will insert rows here -->
                </tbody>
            </table>

            <!-- Pagination -->
            <div class="pagination" id="pagination">
                <!-- Pagination buttons will be generated by JavaScript -->
            </div>
        </div>
    </div>

    <script>
        // JSON data

        const rowsPerPage = 5;  // Number of records per page
        let currentPage = 1;

        // Function to display a specific page of the data
        function displayPage(page) {
            const tableBody = document.getElementById('record-table-body');
            tableBody.innerHTML = ''; // Clear the table
            const start = (page - 1) * rowsPerPage;
            const end = start + rowsPerPage;
            const paginatedData = data.slice(start, end);

            paginatedData.forEach((record, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${start + index + 1}</td>
                    <td>${record.cve}</td>
                    <td>${record.created_at}</td>
                `;

                // Make the row clickable
                row.addEventListener('click', function() {
                    // Replace this URL with the actual URL you want to navigate to
                    window.location.href = `/finalreport?cve_code=${record.cve}`;
                });

                tableBody.appendChild(row);
            });

            setupPagination();
        }

        // Function to set up the pagination buttons
        function setupPagination() {
            const paginationDiv = document.getElementById('pagination');
            paginationDiv.innerHTML = '';  // Clear existing pagination buttons
            const pageCount = Math.ceil(data.length / rowsPerPage);
            const maxPages = 5;  // Maximum number of pagination buttons to show

            // Calculate the range of pages to show
            let startPage = Math.max(1, currentPage - Math.floor(maxPages / 2));
            let endPage = Math.min(pageCount, startPage + maxPages - 1);

            if (endPage - startPage < maxPages - 1) {
                startPage = Math.max(1, endPage - maxPages + 1);
            }

            // Create "Previous" button
            if (currentPage > 1) {
                const prevButton = document.createElement('a');
                prevButton.href = '#';
                prevButton.innerText = '« ';
                prevButton.addEventListener('click', function(event) {
                    event.preventDefault();
                    currentPage--;
                    displayPage(currentPage);
                });
                paginationDiv.appendChild(prevButton);
            }

            // Create page number buttons
            for (let i = startPage; i <= endPage; i++) {
                const pageButton = document.createElement('a');
                pageButton.href = '#';
                pageButton.innerText = i+" ";
                if (i === currentPage) {
                    pageButton.classList.add('active');
                }

                pageButton.addEventListener('click', function(event) {
                    event.preventDefault();
                    currentPage = i;
                    displayPage(currentPage);
                });

                paginationDiv.appendChild(pageButton);
            }

            // Create "Next" button
            if (currentPage < pageCount) {
                const nextButton = document.createElement('a');
                nextButton.href = '#';
                nextButton.innerText = '»';
                nextButton.addEventListener('click', function(event) {
                    event.preventDefault();
                    currentPage++;
                    displayPage(currentPage);
                });
                paginationDiv.appendChild(nextButton);
            }
        }

        // Initial page load
        displayPage(currentPage);

    </script>

</body>
</html>
